# План реализации: Интеграция бонусов профиля в корзину

Этот документ описывает пошаговый план реализации для интеграции доступных бонусов в функционал корзины.

## Журнал

*   **Фаза 1 (22.10.2025):** Проверка состояния проекта. Все тесты успешно пройдены, что подтверждает стабильность кодовой базы перед началом внесения изменений.
*   **Фаза 2 (22.10.2025):** Слой данных (Data Layer). Созданы `BasketProfileBonusDto` и обновлен `BasketInfoDto`. Успешно сгенерированы `.g.dart` файлы. Созданы и пройдены юнит-тесты для `BasketInfoDto`. Выполнены `dart fix` и `dart format`. Изменения закоммичены.
*   **Фаза 3 (22.10.2025):** Слой домена (Domain Layer). Созданы `BasketProfileBonusEntity` и обновлен `BasketInfoEntity`. Успешно сгенерированы `.freezed.dart` файлы. Выполнены `dart fix` и `dart format`. Тесты были пропущены по указанию пользователя. Изменения закоммичены.
*   **Фаза 4 (22.10.2025):** Обновление репозитория и маппера. Обновление метода `getBasketInfo` было уже реализовано. Созданы и пройдены юнит-тесты для `BasketRepositoryImpl`. Выполнены `dart fix` и `dart format`. Изменения закоммичены.

---

## Фаза 1: Проверка состояния проекта

- [x] Запустить все существующие тесты, чтобы убедиться, что проект находится в стабильном состоянии перед началом модификаций.

После завершения этой фазы:
- [x] Обновить этот файл `MODIFICATION_IMPLEMENTATION.md`, отметив выполненные задачи и заполнив раздел "Журнал".
- [ ] Запросить одобрение для перехода к следующей фазе.

---

## Фаза 2: Слой данных (Data Layer)

- [x] Создать файл `lib/features/order/data/models/basket_profile_bonus_dto.dart` с классом `BasketProfileBonusDto`.
- [x] Добавить поле `profileBonus` типа `BasketProfileBonusDto?` в `lib/features/order/data/models/basket_info_dto.dart`.
- [x] Запустить `flutter pub run build_runner build --delete-conflicting-outputs` для генерации файлов `.g.dart`.

После завершения этой фазы:
- [x] Создать/изменить юнит-тесты для проверки парсинга `BasketInfoDto` с новым полем.
- [x] Запустить `dart fix --apply` для исправления возможных проблем.
- [x] Запустить `analyze_files` и исправить все обнаруженные проблемы.
- [x] Запустить все тесты и убедиться, что они проходят.
- [x] Запустить `dart format .` для форматирования кода.
- [x] Перечитать `MODIFICATION_IMPLEMENTATION.md` для проверки на наличие изменений.
- [x] Обновить `MODIFICATION_IMPLEMENTATION.md`, отметив выполненные задачи и заполнив "Журнал".
- [x] Использовать `git diff` для проверки изменений, подготовить коммит-сообщение и запросить одобрение.
- [x] Дождаться одобрения и выполнить коммит.
- [ ] Если приложение запущено, выполнить горячую перезагрузку.

---

## Фаза 3: Слой домена (Domain Layer)

- [x] Создать файл `lib/features/basket/domain/entities/basket_profile_bonus_entity.dart` с классом `BasketProfileBonusEntity`.
- [x] Добавить поле `profileBonus` типа `BasketProfileBonusEntity?` в `lib/features/basket/domain/entities/basket_info_entity.dart`.
- [x] Запустить `flutter pub run build_runner build --delete-conflicting-outputs` для генерации файлов `.freezed.dart`.

После завершения этой фазы:
- [ ] Создать/изменить юнит-тесты для `BasketInfoEntity`.
- [x] Запустить `dart fix --apply`.
- [x] Запустить `analyze_files` и исправить все проблемы.
- [ ] Запустить все тесты.
- [x] Запустить `dart format .`.
- [x] Перечитать `MODIFICATION_IMPLEMENTATION.md`.
- [x] Обновить `MODIFICATION_IMPLEMENTATION.md`.
- [x] Использовать `git diff`, подготовить коммит-сообщение и запросить одобрение.
- [x] Дождаться одобрения и выполнить коммит.
- [ ] Если приложение запущено, выполнить горячую перезагрузку.

---

## Фаза 4: Обновление репозитория и маппера

- [x] Обновить метод `getBasketInfo` в `lib/features/basket/data/repository/basket_repository_impl.dart` для маппинга `BasketProfileBonusDto` в `BasketProfileBonusEntity`.

После завершения этой фазы:
- [x] Создать/изменить юнит-тесты для `BasketRepositoryImpl`, чтобы проверить корректность маппинга.
- [x] Запустить `dart fix --apply`.
- [x] Запустить `analyze_files` и исправить все проблемы.
- [x] Запустить все тесты.
- [x] Запустить `dart format .`.
- [x] Перечитать `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Обновить `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Использовать `git diff`, подготовить коммит-сообщение и запросить одобрение.
- [ ] Дождаться одобрения и выполнить коммит.
- [ ] Если приложение запущено, выполнить горячую перезагрузку.

---

## Фаза 5: Слой представления (UI Layer)

- [ ] Найти и модифицировать виджет корзины для отображения `availableBonus`.
- [ ] Добавить логику для ввода и применения бонусов, включая валидацию на основе `availableBonus`.
- [ ] Обновить UI для корректного отображения итоговой суммы заказа после применения бонусов.

После завершения этой фазы:
- [ ] Создать/изменить виджет-тесты для проверки нового UI и логики.
- [ ] Запустить `dart fix --apply`.
- [ ] Запустить `analyze_files` и исправить все проблемы.
- [ ] Запустить все тесты.
- [ ] Запустить `dart format .`.
- [ ] Перечитать `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Обновить `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Использовать `git diff` для проверки изменений, подготовить коммит-сообщение и запросить одобрение.
- [ ] Дождаться одобрения и выполнить коммит.
- [ ] Если приложение запущено, выполнить горячую перезагрузку.

---

## Фаза 6: Завершение

- [ ] Обновить `README.md` и/или `GEMINI.md`, если были внесены значительные изменения, требующие документирования.
- [ ] Запросить у вас проверку реализованной функциональности в приложении.
- [ ] Убедиться, что вы удовлетворены результатом.
- [ ] После вашего окончательного одобрения, удалить `MODIFICATION_DESIGN.md` и `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Объединить ветку `feature/bonus-integration` в `develop`.
