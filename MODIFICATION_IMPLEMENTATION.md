# План реализации: Кнопка оплаты для неоплаченных заказов

## Журнал

**Фаза 1 (2025-10-14):**
*   Проверил, что все тесты проходят (`+4: All tests passed!`).
*   Изучил файлы `order_page.dart`, `order_details.dart`, `order_details_bloc.dart` и `order_bloc.dart`.
*   Определил, что основная логика UI находится в `order_details.dart`, а логика действий с заказом — в `order_bloc.dart`.
*   Запустил `dart_fix` и `analyze_files`. `analyze_files` показал множество предупреждений, но нет критических ошибок. Проигнорировал их согласно инструкции.
*   Запустил `dart_format`. Изменений нет.
*   Никаких изменений в код на этой фазе не вносилось.

## План

### Фаза 1: Подготовка и анализ

- [x] Проверить, что все существующие тесты проходят успешно, чтобы убедиться в стабильности проекта перед началом изменений.
- [x] Внимательно прочитать файл `lib/features/order/presentation/pages/order_page.dart`, чтобы понять его структуру, используемые виджеты и логику отображения данных.
- [x] Изучить связанный BLoC/Cubit и файлы состояний, чтобы понять, как управляется состояние экрана деталей заказа.
- [x] После завершения задачи, если я добавлю какие-либо TODO в код или не полностью что-то реализую, я обязательно добавлю новые задачи в этот план, чтобы вернуться к ним позже.
- [x] Запустить `dart_fix` для очистки кода.
- [x] Запустить `analyze_files` и исправить все ошибки (проигнорировав предупреждения).
- [x] Запустить тесты еще раз, чтобы убедиться, что все проходит успешно.
- [x] Отформатировать код с помощью `dart_format`.
- [x] Перечитать этот файл (`MODIFICATION_IMPLEMENTATION.md`), чтобы проверить наличие изменений в плане.
- [x] Обновить этот файл, отметив выполненные пункты и записав любые наблюдения в раздел "Журнал".
- [ ] Просмотреть изменения с помощью `git diff` и подготовить коммит-сообщение для утверждения.
- [ ] Дождаться вашего одобрения перед коммитом.

### Фаза 2: Модификация пользовательского интерфейса

- [ ] В файле `order_details.dart` добавить логику для условного отображения:
    - Текстовой метки "Требуется оплата" красного цвета, если `paymentStatus` равно `false`.
    - Кнопки "Оплатить заказ" вместо кнопки "Отменить заказ", если `paymentStatus` равно `false`.
- [ ] После завершения задачи, если я добавлю какие-либо TODO в код или не полностью что-то реализую, я обязательно добавлю новые задачи в этот план, чтобы вернуться к ним позже.
- [ ] Создать/изменить юнит-тесты для проверки новой логики отображения, если это применимо.
- [ ] Запустить `dart_fix` для очистки кода.
- [ ] Запустить `analyze_files` и исправить все ошибки.
- [ ] Запустить тесты.
- [ ] Отформатировать код с помощью `dart_format`.
- [ ] Перечитать и обновить `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Подготовить коммит-сообщение и дождаться вашего одобрения.

### Фаза 3: Реализация бизнес-логики

- [ ] Определить, какой BLoC/Cubit используется в `order_page.dart`.
- [ ] Добавить новое событие (event) в BLoC/Cubit для инициации процесса оплаты (например, `PayOrder`).
- [ ] Добавить новый метод в `OrderRepository` и `OrderDatasource` для выполнения GET-запроса на `https://admin.monobox.app/api/v1/order/pay/{ID}`.
- [ ] В BLoC/Cubit обработать событие `PayOrder`, вызвать метод репозитория, получить `payment_url` и передать его в новое состояние (state), например, `OrderPaymentUrlReady`.
- [ ] В `order_page.dart` подписаться на новое состояние и при его получении выполнить навигацию на `CustonWebViewPage`, передав `payment_url`.
- [ ] После завершения задачи, если я добавлю какие-либо TODO в код или не полностью что-то реализую, я обязательно добавлю новые задачи в этот план, чтобы вернуться к ним позже.
- [ ] Создать/изменить юнит-тесты для новой бизнес-логики.
- [ ] Запустить `dart_fix` для очистки кода.
- [ ] Запустить `analyze_files` и исправить все ошибки.
- [ ] Запустить тесты.
- [ ] Отформатировать код с помощью `dart_format`.
- [ ] Перечитать и обновить `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Подготовить коммит-сообщение и дождаться вашего одобрения.

### Фаза 4: Завершение

- [ ] Обновить `README.md` или другие файлы документации, если это необходимо.
- [ ] Обновить файл `GEMINI.md` в проекте, чтобы он корректно описывал изменения.
- [ ] Попросить вас проверить функциональность в приложении и подтвердить, что результат соответствует ожиданиям.