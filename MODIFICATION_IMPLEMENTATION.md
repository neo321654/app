# План Реализации: Отображение Времени Доставки

Этот документ описывает пошаговый план по реализации отображения времени доставки в корзине.

## Журнал

*   **2025-10-14:** Начало работы. План реализации создан и одобрен.
*   **2025-10-14:** Фаза 0 завершена. Исходное состояние проекта проверено, все тесты пройдены.
*   **2025-10-14:** Фаза 1 завершена. Модели данных `BasketInfoRequestBasketDto`, `BasketInfoDto` и `BasketInfoEntity` были обновлены для включения полей `filialId` и `timeDelay`. Запущена кодогенерация. Все проверки пройдены успешно.
*   **2025-10-14:** Фаза 2 завершена. `BasketRepositoryImpl` обновлен для корректной передачи `filial_id` (полученного из `CreateOrderStateCubit`) в запрос корзины. Также добавлена обработка поля `time_delay` из ответа. Раскомментирована логика в `main.dart` для установки филиала по умолчанию.

---

## Поэтапный План Реализации

**Общее правило:** После выполнения задачи, если в код были добавлены `TODO` или что-то было реализовано не до конца, необходимо добавить новые задачи в этот план, чтобы вернуться к ним позже.

**Важное замечание по анализу кода:** При выполнении шага `analyze_files` внимание будет обращаться **только на ошибки (errors)**. Предупреждения (warnings), информация (info) и предложения по исправлению (fixes) будут игнорироваться. Цель — исправить только критические ошибки, мешающие работе приложения.

### Фаза 0: Подготовка

- [x] Запустить все тесты, чтобы убедиться в исправности проекта перед началом модификаций.
- [x] Обновить этот файл (`MODIFICATION_IMPLEMENTATION.md`), отметив выполненные пункты и заполнив журнал.

### Фаза 1: Модификация Слоя Данных и Домена

- [x] Добавить поле `filialId` в `lib/features/order/data/models/basket_info_request_basket_dto.dart`.
- [x] Добавить поле `timeDelay` в `lib/features/order/data/models/basket_info_dto.dart`.
- [x] Добавить поле `timeDelay` в `lib/features/basket/domain/entities/basket_info_entity.dart`.
- [x] Запустить `dart run build_runner build --delete-conflicting-outputs` для обновления сгенерированных файлов.
- [x] Запустить `dart_fix` для исправления кода.
- [x] Запустить `analyze_files` для анализа и исправления ошибок.
- [x] Запустить все тесты.
- [x] Запустить `dart_format` для форматирования.
- [x] Проверить изменения с помощью `git diff` и подготовить коммит.
- [x] **Получить ваше одобрение** на коммит.
- [x] Сделать коммит.
- [x] Обновить `MODIFICATION_IMPLEMENTATION.md`.

### Фаза 2: Модификация Слоя Репозитория

- [x] Обновить `lib/features/basket/data/repository/basket_repository_impl.dart`:
    - Получить `filial_id` из `FilialCubit`.
    - Передать `filial_id` в конструктор `BasketInfoRequestBasketDto`.
    - При маппинге ответа, передать `timeDelay` из `BasketInfoDto` в `BasketInfoEntity`.
- [x] Создать/модифицировать юнит-тесты для `BasketRepositoryImpl`, если это необходимо.
- [x] Запустить `dart_fix`.
- [x] Запустить `analyze_files`.
- [x] Запустить тесты.
- [x] Запустить `dart_format`.
- [x] Проверить изменения и подготовить коммит.
- [x] **Получить ваше одобрение** на коммит.
- [x] Сделать коммит.
- [x] Обновить `MODIFICATION_IMPLEMENTATION.md`.

### Фаза 3: Модификация Управления Состоянием (BLoC)

- [ ] Добавить поле `timeDelay` в состояние `BasketSuccess` в файле `lib/features/basket/presentation/bloc/basket/basket_state.dart`.
- [ ] Обновить `BasketBloc` для сохранения `timeDelay` в `BasketSuccess` при успешном получении данных о корзине.
- [ ] Создать/модифицировать юнит-тесты для `BasketBloc`, если это необходимо.
- [ ] Запустить `dart_fix`.
- [ ] Запустить `analyze_files`.
- [ ] Запустить тесты.
- [ ] Запустить `dart_format`.
- [ ] Проверить изменения и подготовить коммит.
- [ ] **Получить ваше одобрение** на коммит.
- [ ] Сделать коммит.
- [ ] Обновить `MODIFICATION_IMPLEMENTATION.md`.

### Фаза 4: Модификация Пользовательского Интерфейса (UI)

- [ ] В виджете `lib/features/basket/presentation/widgets/itogo_bottom.dart` добавить отображение времени доставки.
    - Использовать `BlocBuilder<BasketBloc, BasketState>` для получения доступа к `timeDelay`.
    - Отображать виджет (например, `Row` с иконкой и текстом) только если `timeDelay` не пустой.
- [ ] Запустить `dart_fix`.
- [ ] Запустить `analyze_files`.
- [ ] Запустить тесты.
- [ ] Запустить `dart_format`.
- [ ] Проверить изменения и подготовить коммит.
- [ ] **Получить ваше одобрение** на коммит.
- [ ] Сделать коммит.
- [ ] Обновить `MODIFICATION_IMPLEMENTATION.md`.

### Фаза 5: Завершение

- [ ] Переключиться на ветку `develop-Mexico`.
- [ ] Выполнить слияние ветки `feature/delivery-time` с помощью `git merge --no-ff feature/delivery-time`.
- [ ] Предложить `git push` для ветки `develop-Mexico` и дождаться одобрения.
- [ ] Удалить feature-ветку: `git branch -d feature/delivery-time`.
- [ ] Удалить файлы `MODIFICATION_DESIGN.md` и `MODIFICATION_IMPLEMENTATION.md`.
- [ ] Сделать финальный коммит с удалением временных файлов.
- [ ] Попросить вас проверить результат и подтвердить, что все работает как ожидалось.